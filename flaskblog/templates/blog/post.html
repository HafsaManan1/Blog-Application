{% set show_navbar = True %}
{% set show_footer = True %}
{% extends 'main/base.html'%}
{% block content %}
<!-- Toast container with fixed positioning -->
<div class="toast-container position-fixed top-1 end-0 p-3">
  {% for message in get_flashed_messages(with_categories=true) %}
  <div class="toast align-items-center text-white {{ 'bg-success' if message[0] == 'success' else '' }}
               {{ 'bg-danger' if message[0] == 'error' else '' }}
               {{ 'bg-warning' if message[0] == 'warning' else '' }}
               {{ 'bg-info' if message[0] == 'info' else '' }}
               border-0 fade" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true"
      data-bs-delay="5000">
      <div class="d-flex">
          <div class="toast-body">
              {{ message[1] }}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
              aria-label="Close"></button>
      </div>
  </div>
  {% endfor %}
</div>


<div class="container my-4">
  <div class="shadow p-3 mb-5 bg-body rounded">
    <p class="d-flex justify-content-between">
      <!-- Left aligned 'Back' button -->
      <a href="{{ url_for('blog.posts') }}" class='btn'>
          <i class="fa-solid fa-arrow-left"></i> Back
      </a>
      
      <!-- Right aligned buttons (Edit and Delete) -->
      <span>
          {% if post.poster_id == current_user.id %}
          <a href="{{ url_for('blog.edit_post', id=post.id) }}" class="btn">
              <i class="fa-regular fa-pen-to-square"></i>
          </a>
          <a href="{{ url_for('blog.delete_post', id=post.id) }}" class="btn">
              <i class="fa-solid fa-trash"></i>
          </a>
          {% endif %}
      </span>
  </p>
  
      <h1>{{ post.title }}</h1>
      Blog by: {{ post.poster.username }}<br>
      Published on: {{ post.date_posted.date() }}<br>
      <br>
      <!-- Content with responsive images -->
      <div class="content">
          {{ post.content|safe }}
      </div>
      <br>
  </div>

</div>

<!-- Add custom CSS for responsive images -->
<style>
  .content img {
      max-width: 100%;
      height: auto;
  }
</style>
<div class="container my-4">
  <!-- Comment Form -->
  <h4 class="mb-4">Leave a Comment</h4>

  <form action="{{ url_for('blog.post', id=post.id) }}" method="POST">
    {{ form.hidden_tag() }}
    <div class="mb-3">
      {{ form.content(class="form-control", rows="5", placeholder="Write your comment here...") }}
    </div>
    <div class="d-flex justify-content-end">
      {{ form.submit(class="btn btn-primary") }}
    </div>
  </form>

  <!-- Comments List -->
  <h4 class="my-4">Comments</h4>
  <div class="list-group">
    {% for comment in comments %}
    <div class="list-group-item mb-3">
      <h5 class="mb-1">{{ comment.commenter.name }}</h5>
      <p class="mb-1">{{ comment.content }}</p>
    </div>
    {% endfor %}
  </div>
</div>

</div>

<script>
  var toastElList = [].slice.call(document.querySelectorAll('.toast'));
  var toastList = toastElList.map(function (toastEl) {
      var toast = new bootstrap.Toast(toastEl, { autohide: true, delay: 5000 });
      toast.show();  // Show the toast with fade-in effect
      return toast;
  });
  </script>

{% endblock %}
