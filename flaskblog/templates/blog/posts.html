{% set show_navbar = True %}
{% set show_footer = True %}
{% extends 'main/base.html' %}
{% block content %}
<div class="toast-container position-fixed top-0 end-0 p-3">
  <br><br>
  {% for message in get_flashed_messages(with_categories=true) %}
  <div class="toast align-items-center text-white {{ 'bg-success' if message[0] == 'success' else '' }}
               {{ 'bg-danger' if message[0] == 'error' else '' }}
               {{ 'bg-warning' if message[0] == 'warning' else '' }}
               {{ 'bg-info' if message[0] == 'info' else '' }}
               border-0 fade" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true"
      data-bs-delay="5000">
      <div class="d-flex">
          <div class="toast-body">
              {{ message[1] }}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
              aria-label="Close"></button>
      </div>
  </div>
  {% endfor %}
</div>

<!-- Blog Posts -->
<div class="container my-4">
  <br><br>
  <div class="row">
    {% for post in posts %}
    <div class="col-md-4 mb-4">
      <div class="card h-100">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title"><a href="{{ url_for('blog.post', id=post.id) }}" class="text-decoration-none">{{ post.title }}</a></h5>
          <h6 class="card-subtitle mb-2 text-muted">By: {{ post.poster.username }}</h6>
          <p class="card-text flex-grow-1">
            {{ post.content|striptags|truncate(100, True) }}
          </p>
          <div class="d-flex justify-content-between mt-auto">
            <div>
                {% if post.poster.id == current_user.id %}
                <a href="{{ url_for('blog.edit_post', id=post.id) }}" class="btn"><i class="fa-regular fa-pen-to-square"></i></a>
                <a href="{{ url_for('blog.delete_post', id=post.id) }}" class="btn"><i class="fa-solid fa-trash"></i></a>
                {% endif %}
            </div>
            <div>
                <a href="{{ url_for('blog.post', id=post.id) }}" class='btn text-secondary'>
                    Read More <i class="fa-solid fa-arrow-right"></i>
                </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
<br><br> 


<!-- Pagination Controls -->
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center my-4">
    {% if posts.has_prev %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('blog.posts', page=posts.prev_num) }}" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    {% else %}
    <li class="page-item disabled">
      <span class="page-link" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </span>
    </li>
    {% endif %}

    {% for page_num in posts.iter_pages() %}
    {% if page_num %}
    {% if page_num == posts.page %}
    <li class="page-item active" aria-current="page">
      <span class="page-link">{{ page_num }}</span>
    </li>
    {% else %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('blog.posts', page=page_num) }}">{{ page_num }}</a>
    </li>
    {% endif %}
    {% else %}
    <li class="page-item disabled">
      <span class="page-link">...</span>
    </li>
    {% endif %}
    {% endfor %}

    {% if posts.has_next %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('blog.posts', page=posts.next_num) }}" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    {% else %}
    <li class="page-item disabled">
      <span class="page-link" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </span>
    </li>
    {% endif %}
  </ul>
</nav>
<br><br>

<script>
  // Initialize and show the toasts with smooth animation and auto-dismiss after 5 seconds
  var toastElList = [].slice.call(document.querySelectorAll('.toast'));
    var toastList = toastElList.map(function (toastEl) {
        var toast = new bootstrap.Toast(toastEl, { autohide: true, delay: 5000 });
        toast.show();  // Show the toast with fade-in effect
        return toast;
    });
</script>
{% endblock %}